\doxysection{D3\+D12\+Util.\+h}
\hypertarget{_d3_d12_util_8h_source}{}\label{_d3_d12_util_8h_source}\index{Dark Engine/Source/Runtime/D3D12RHI/private/D3D12Util.h@{Dark Engine/Source/Runtime/D3D12RHI/private/D3D12Util.h}}
\mbox{\hyperlink{_d3_d12_util_8h}{См. документацию.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#pragma\ once}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{_d3_d12_resources_8h}{D3D12Resources.h}}"{}}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ <\mbox{\hyperlink{_d3_d12_8h}{d3d12.h}}>}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ <comdef.h>}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ }
\DoxyCodeLine{00007\ \textcolor{keyword}{static}\ DXGI\_FORMAT\ \mbox{\hyperlink{_d3_d12_util_8h_a4624beca62d94828692a7802f72e3ae2}{GDXGIFormats}}[\mbox{\hyperlink{_pixel_format_8h_afb559e26bc610db43ba605230a142898a928f33270be19855038d0245a0fa06a1}{EPixelFormat::Count}}]\ =\ }
\DoxyCodeLine{00008\ \{}
\DoxyCodeLine{00009\ \ \ \ \ DXGI\_FORMAT\_UNKNOWN,}
\DoxyCodeLine{00010\ \ \ \ \ DXGI\_FORMAT\_R32G32B32A32\_FLOAT,}
\DoxyCodeLine{00011\ \ \ \ \ DXGI\_FORMAT\_R32\_FLOAT,}
\DoxyCodeLine{00012\ \ \ \ \ DXGI\_FORMAT\_R8G8B8A8\_UNORM,}
\DoxyCodeLine{00013\ \ \ \ \ DXGI\_FORMAT\_R32G32B32A32\_UINT,}
\DoxyCodeLine{00014\ \ \ \ \ DXGI\_FORMAT\_B8G8R8A8\_UNORM}
\DoxyCodeLine{00015\ \ \ \ \ \textcolor{comment}{//DXGI\_FORMAT\_DE}}
\DoxyCodeLine{00016\ \};}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ }
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{comment}{/*PT\_TriangleList,}}
\DoxyCodeLine{00021\ \textcolor{comment}{\ \ \ \ PT\_TriangleStrip,}}
\DoxyCodeLine{00022\ \textcolor{comment}{\ \ \ \ PT\_LineList,}}
\DoxyCodeLine{00023\ \textcolor{comment}{\ \ \ \ PT\_QuadList,}}
\DoxyCodeLine{00024\ \textcolor{comment}{\ \ \ \ PT\_PointList,}}
\DoxyCodeLine{00025\ \textcolor{comment}{\ \ \ \ PT\_Num*/}}
\DoxyCodeLine{00026\ }
\DoxyCodeLine{00027\ \textcolor{keyword}{static}\ FORCEINLINE\ D3D\_PRIMITIVE\_TOPOLOGY\ \mbox{\hyperlink{_d3_d12_util_8h_af095c73fb61404dd5508139bf2bcae61}{GetD3D12PrimitiveTopology}}(\mbox{\hyperlink{_platform_8h_a8c7a127091efbdfc5a16939041653e05}{uint32}}\ PrimitiveTopology)}
\DoxyCodeLine{00028\ \{}
\DoxyCodeLine{00029\ \ \ \ \ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_platform_8h_a40bc01dd090acd02a79b5dc13e08abe6}{uint8}}\ D3D12PrimitiveTopology[]\ =}
\DoxyCodeLine{00030\ \ \ \ \ \{}
\DoxyCodeLine{00031\ \ \ \ \ \ \ \ \ D3D\_PRIMITIVE\_TOPOLOGY\_TRIANGLELIST,}
\DoxyCodeLine{00032\ \ \ \ \ \ \ \ \ D3D\_PRIMITIVE\_TOPOLOGY\_TRIANGLESTRIP,}
\DoxyCodeLine{00033\ \ \ \ \ \ \ \ \ D3D\_PRIMITIVE\_TOPOLOGY\_LINELIST,}
\DoxyCodeLine{00034\ \ \ \ \ \ \ \ \ 0,}
\DoxyCodeLine{00035\ \ \ \ \ \ \ \ \ D3D\_PRIMITIVE\_TOPOLOGY\_POINTLIST}
\DoxyCodeLine{00036\ \ \ \ \ \};}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \ \ \ \ \textcolor{keywordflow}{return}\ (D3D\_PRIMITIVE\_TOPOLOGY)D3D12PrimitiveTopology[PrimitiveTopology];}
\DoxyCodeLine{00039\ \}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ FORCEINLINE\ D3D12\_RESOURCE\_STATES\ \mbox{\hyperlink{_d3_d12_util_8h_a1148ba9d0de8a596562321bb600291f9}{GetD3D12ResourceState}}(\mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5f}{ERHIAccess}}\ InRHIAccess)}
\DoxyCodeLine{00044\ \{}
\DoxyCodeLine{00045\ \ \ \ \ D3D12\_RESOURCE\_STATES\ State\ =\ D3D12\_RESOURCE\_STATE\_COMMON;}
\DoxyCodeLine{00046\ \ \ \ \ \textcolor{keywordflow}{switch}\ (InRHIAccess)}
\DoxyCodeLine{00047\ \ \ \ \ \{}
\DoxyCodeLine{00048\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5faa0aac243c3603df5e9458c01f4d48d4f}{ERHIAccess::CpuRead}}:\ \textcolor{keywordflow}{return}\ State\ |D3D12\_RESOURCE\_STATE\_COPY\_SOURCE;}
\DoxyCodeLine{00049\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5fadd058df87f5c88e3285a28ad7406a3c6}{ERHIAccess::Present}}:\ \textcolor{keywordflow}{return}\ State\ |\ D3D12\_RESOURCE\_STATE\_PRESENT;}
\DoxyCodeLine{00050\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5fa9b4ca42c29ad44078049099371cf37ae}{ERHIAccess::VertexOrIndexBuffer}}:\ \textcolor{keywordflow}{return}\ State\ |\ D3D12\_RESOURCE\_STATE\_VERTEX\_AND\_CONSTANT\_BUFFER\ |\ D3D12\_RESOURCE\_STATE\_INDEX\_BUFFER;}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5fa7bab7e5a5c4af7c1283d86b9e2715b42}{ERHIAccess::SRVGraphics}}:\ \textcolor{keywordflow}{return}\ State\ |\ D3D12\_RESOURCE\_STATE\_PIXEL\_SHADER\_RESOURCE\ |\ D3D12\_RESOURCE\_STATE\_NON\_PIXEL\_SHADER\_RESOURCE;}
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5fa82a533132e0f92199196ee9b715f190f}{ERHIAccess::UAVCompute}}:}
\DoxyCodeLine{00053\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5fa83e447e8ddbd323a34bbd671d10e495b}{ERHIAccess::UAVGraphics}}:\ \textcolor{keywordflow}{return}\ State\ |\ D3D12\_RESOURCE\_STATE\_UNORDERED\_ACCESS;}
\DoxyCodeLine{00054\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5faad2d89100e475427fae2882f2d5dcc36}{ERHIAccess::RTV}}:\ \textcolor{keywordflow}{return}\ State\ |\ D3D12\_RESOURCE\_STATE\_RENDER\_TARGET;}
\DoxyCodeLine{00055\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5fa8ff7eeaefc98868e476e7ea4ae4dab46}{ERHIAccess::CopyDesc}}:\ \textcolor{keywordflow}{return}\ State\ |\ D3D12\_RESOURCE\_STATE\_COPY\_DEST;}
\DoxyCodeLine{00056\ \ \ \ \ \textcolor{keywordflow}{case}\ \mbox{\hyperlink{_r_h_i_defines_8h_a790a925a3358fc56173b2ffb0f607c5fa94cae2b00d0fd160345a5f81c973430e}{ERHIAccess::DSVWrite}}:\ \textcolor{keywordflow}{return}\ State\ |\ D3D12\_RESOURCE\_STATE\_DEPTH\_WRITE;}
\DoxyCodeLine{00057\ \ \ \ \ \}}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{keywordflow}{return}\ D3D12\_RESOURCE\_STATE\_COMMON;}
\DoxyCodeLine{00060\ \}}
\DoxyCodeLine{00061\ }
\DoxyCodeLine{00062\ }
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ FORCEINLINE\ DXGI\_FORMAT\ \mbox{\hyperlink{_d3_d12_util_8h_ac028dbc41e6752d17b317a83da786425}{GetDXGIFormat}}(\mbox{\hyperlink{_pixel_format_8h_afb559e26bc610db43ba605230a142898}{EPixelFormat}}\ InFormat)}
\DoxyCodeLine{00065\ \{}
\DoxyCodeLine{00066\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{_d3_d12_util_8h_a4624beca62d94828692a7802f72e3ae2}{GDXGIFormats}}[InFormat];}
\DoxyCodeLine{00067\ \}}
\DoxyCodeLine{00068\ \ \ \ \ }
\DoxyCodeLine{00069\ FORCEINLINE\ \mbox{\hyperlink{_platform_8h_a8c7a127091efbdfc5a16939041653e05}{uint32}}\ \mbox{\hyperlink{_d3_d12_util_8h_a5164aa89fed19dade9190cf9fcc5a4e1}{CalcSubresource}}(\mbox{\hyperlink{_platform_8h_a8c7a127091efbdfc5a16939041653e05}{uint32}}\ MipSlice,\ \mbox{\hyperlink{_platform_8h_a8c7a127091efbdfc5a16939041653e05}{uint32}}\ ArraySlice,\ \mbox{\hyperlink{_platform_8h_a8c7a127091efbdfc5a16939041653e05}{uint32}}\ MipLevels)}
\DoxyCodeLine{00070\ \{}
\DoxyCodeLine{00071\ \ \ \ \ \textcolor{keywordflow}{return}\ MipSlice\ +\ ArraySlice\ *\ MipLevels;}
\DoxyCodeLine{00072\ \}}
\DoxyCodeLine{00073\ }
\DoxyCodeLine{00074\ }
\DoxyCodeLine{00075\ FORCEINLINE\ \mbox{\hyperlink{class_f_string}{FString}}\ \mbox{\hyperlink{_d3_d12_util_8h_aa05ac2760af20023246f510331b5da08}{GetDX12ErrorMessage}}(HRESULT\ hr)}
\DoxyCodeLine{00076\ \{}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordflow}{return}\ \_com\_error(hr).ErrorMessage();}
\DoxyCodeLine{00078\ \}}
\DoxyCodeLine{00079\ }
\DoxyCodeLine{00080\ }
\DoxyCodeLine{00081\ FORCEINLINE\ \mbox{\hyperlink{class_f_string}{FString}}\ \mbox{\hyperlink{_d3_d12_util_8h_ab1a38fafd792549c300e94db3eb331b4}{ParseDX12Error}}(HRESULT\ hr)}
\DoxyCodeLine{00082\ \{}
\DoxyCodeLine{00083\ \ \ \ \ \_com\_error\ error(hr);}
\DoxyCodeLine{00084\ \ \ \ \ \textcolor{keywordflow}{return}\ \mbox{\hyperlink{class_f_string}{FString}}(error.ErrorMessage());}
\DoxyCodeLine{00085\ \}}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00087\ }
\DoxyCodeLine{00088\ FORCEINLINE\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_d3_d12_util_8h_a629c58836a825b77141f59781e2082ad}{VerifyD3D12Result}}(HRESULT\ hr,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_platform_8h_ac65a9f028228aed366b4d8f24a8ab9e9}{ANSICHAR}}*\ Code,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_platform_8h_ac65a9f028228aed366b4d8f24a8ab9e9}{ANSICHAR}}*\ Filename,\ \mbox{\hyperlink{_platform_8h_a8c7a127091efbdfc5a16939041653e05}{uint32}}\ Line)}
\DoxyCodeLine{00089\ \{}
\DoxyCodeLine{00090\ \ \ \ \ \mbox{\hyperlink{class_f_string}{FString}}\ Error\ =\ Code;}
\DoxyCodeLine{00091\ \ \ \ \ \mbox{\hyperlink{_log_macros_8h_a8741300d0bc8f72af0519831a732553a}{DE\_LOG}}(\mbox{\hyperlink{class_d3_d12_r_h_i}{D3D12RHI}},\ Error,\ \mbox{\hyperlink{_platform_8h_a2978f60d40d64f3605b5a99f66f292a9}{TEXT}}(\textcolor{stringliteral}{"{}\%s\ =\ \%s\ \(\backslash\)t\ in\ \%s(\%i)"{}}),\ *\mbox{\hyperlink{_d3_d12_util_8h_aa05ac2760af20023246f510331b5da08}{GetDX12ErrorMessage}}(hr),\ *Error,\ *\mbox{\hyperlink{class_f_string}{FString}}(Filename),\ Line);}
\DoxyCodeLine{00092\ \}}
\DoxyCodeLine{00093\ }
\DoxyCodeLine{00094\ }
\DoxyCodeLine{00095\ }
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00097\ \textcolor{preprocessor}{\#define\ DXCall(x)\ \{HRESULT\ Result\ =\ x;\ if(FAILED(Result))\ \{VerifyD3D12Result(Result,\ \#x,\ \_\_FILE\_\_,\ \_\_LINE\_\_);\}\}}}
\DoxyCodeLine{00098\ }
\DoxyCodeLine{00099\ }
\DoxyCodeLine{00100\ }
\DoxyCodeLine{00101\ FORCEINLINE\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_d3_d12_util_8h_a3281f57ae673061cbf263b962e70bc86}{SetName}}(ID3D12Object*\ \textcolor{keyword}{const}\ Object,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_platform_8h_a74140f1ff3f7a51b1ac752f90283f3d6}{TCHAR}}*\ \textcolor{keyword}{const}\ Name)}
\DoxyCodeLine{00102\ \{}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keywordflow}{if}\ (Object\ \&\&\ Name)}
\DoxyCodeLine{00104\ \ \ \ \ \{}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ Object-\/>SetName(Name);}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00107\ \ \ \ \ \}}
\DoxyCodeLine{00108\ \ \ \ \ Object-\/>SetName(L\textcolor{stringliteral}{"{}NULL"{}});}
\DoxyCodeLine{00109\ }
\DoxyCodeLine{00110\ }
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00112\ \}}
\DoxyCodeLine{00113\ }
\DoxyCodeLine{00114\ FORCEINLINE\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{_d3_d12_util_8h_a3281f57ae673061cbf263b962e70bc86}{SetName}}(\mbox{\hyperlink{class_f_d3_d12_resource}{FD3D12Resource}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_d3_d12_main_8h_ab8eaee8f45f36954297ee6146eb6db20}{Resource}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_platform_8h_a74140f1ff3f7a51b1ac752f90283f3d6}{TCHAR}}*\ \textcolor{keyword}{const}\ Name)}
\DoxyCodeLine{00115\ \{}
\DoxyCodeLine{00116\ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_d3_d12_main_8h_ab8eaee8f45f36954297ee6146eb6db20}{Resource}}\ \&\&\ Name)}
\DoxyCodeLine{00117\ \ \ \ \ \{}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_d3_d12_main_8h_ab8eaee8f45f36954297ee6146eb6db20}{Resource}}-\/>GetResource()-\/>SetName(Name);}
\DoxyCodeLine{00119\ \ \ \ \ \}}
\DoxyCodeLine{00120\ \}}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00122\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_d_x12}{DX12}}}
\DoxyCodeLine{00123\ \{}
\DoxyCodeLine{00124\ \ \ \ \ FORCEINLINE\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespace_d_x12_aa05665b3cc0abac0b0390387534b5867}{SetName}}(ID3D12Object*\ \textcolor{keyword}{const}\ Object,\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_platform_8h_a74140f1ff3f7a51b1ac752f90283f3d6}{TCHAR}}*\ \textcolor{keyword}{const}\ Name)}
\DoxyCodeLine{00125\ \ \ \ \ \{}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Object\ \&\&\ Name)}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ Object-\/>SetName(Name);}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00131\ \ \ \ \ \ \ \ \ Object-\/>SetName(L\textcolor{stringliteral}{"{}NULL"{}});}
\DoxyCodeLine{00132\ }
\DoxyCodeLine{00133\ }
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \ \ \ \ \}}
\DoxyCodeLine{00136\ }
\DoxyCodeLine{00137\ \ \ \ \ FORCEINLINE\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{namespace_d_x12_aa05665b3cc0abac0b0390387534b5867}{SetName}}(\mbox{\hyperlink{class_f_d3_d12_resource}{FD3D12Resource}}*\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_d3_d12_main_8h_ab8eaee8f45f36954297ee6146eb6db20}{Resource}},\ \textcolor{keyword}{const}\ \mbox{\hyperlink{_platform_8h_a74140f1ff3f7a51b1ac752f90283f3d6}{TCHAR}}*\ \textcolor{keyword}{const}\ Name)}
\DoxyCodeLine{00138\ \ \ \ \ \{}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\mbox{\hyperlink{_d3_d12_main_8h_ab8eaee8f45f36954297ee6146eb6db20}{Resource}}\ \&\&\ Name)}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{_d3_d12_main_8h_ab8eaee8f45f36954297ee6146eb6db20}{Resource}}-\/>GetResource()-\/>SetName(Name);}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00143\ \ \ \ \ \}}
\DoxyCodeLine{00144\ }
\DoxyCodeLine{00145\ \}}
\DoxyCodeLine{00146\ }

\end{DoxyCode}
